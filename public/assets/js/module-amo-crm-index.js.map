{"version":3,"sources":["src/module-amo-crm-index.js"],"names":["idUrl","idForm","className","inputClassName","ModuleAmoCrm","$formObj","$","$checkBoxes","$dropDowns","saveTableAJAXUrl","window","location","origin","globalRootUrl","deleteRecordAJAXUrl","$disabilityFields","$statusToggle","$moduleStatus","authWindow","undefined","validateRules","textField","identifier","rules","type","prompt","globalTranslate","mod_tplValidateValueIsEmpty","areaField","passwordField","generatePassword","length","charset","retVal","i","n","charAt","Math","floor","random","initialize","checkbox","onChange","onChangeSettings","dropdown","checkStatusToggle","addEventListener","initializeForm","tab","checkStatus","setInterval","bind","updateAuthInfo","on","e","val","removeClass","client_id","parent","state","encodeURIComponent","redirect_uri","url","popup","open","preventDefault","id","target","closest","attr","deleteRule","dataTable","lengthChange","processing","paging","deferRender","autoWidth","columns","orderable","searchable","language","SemanticLocalization","dataTableLocalisation","order","show","hide","remove","api","successTest","response","Object","keys","onSuccess","success","find","UserMessage","showError","message","error","ex_ImpossibleToDeleteExtension","get","result","elStatusAuth","addClass","text","module_amo_crm_connect_ok","module_amo_crm_connect_fail","data","lastContactsSyncTime","params","originalEvent","code","module_amo_crm_connect_refresh","post","errorText","messages","hint","detail","mod_amo_Error","close","makeDropdownList","selectType","selected","values","name","value","each","index","obj","push","changeGroupInList","choice","tdInput","currentRowId","tableName","replace","sendChangesToServer","initTable","options","columnsArray4Sort","colName","DataTable","ajax","ajaxUrl","dataSrc","sDom","pageLength","infoCallback","settings","start","end","max","total","pre","ordering","createdRow","row","cols","headers","key","indexOf","eq","html","templateDeleteButton","DT_RowId","bt_ToolTipDelete","template","additionalClass","header","selectMetaData","newTemplate","drawCallback","drowSelectGroup","sTableId","body","parents","transition","document","keyCode","which","hasClass","endEditInput","deleteRow","addNewRow","cbOnDrop","table","priorityWasChanged","priorityData","ruleId","oldPriority","parseInt","newPriority","rowIndex","isNaN","method","$el","idTable","rowTemplate","before","tableId","selestGroup","tableDnD","onDrop","onDragClass","dragHandle","substr","append","recordId","notEmpty","rowId","onFailure","showMultiString","onError","errorMessage","element","xhr","status","applyConfigurationChanges","changeStatus","cbBeforeSendForm","form","cbAfterSendForm","Form","module_amo_crmConnected","module_amo_crmDisconnected","module_amo_crmUpdateStatus","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 11 2018\n */\n\nconst idUrl     \t = 'module-amo-crm';\nconst idForm    \t = 'module-amo-crm-form';\nconst className \t = 'ModuleAmoCrm';\nconst inputClassName = 'mikopbx-module-input';\n\n/* global $, globalRootUrl, globalTranslate, Form, Config */\nconst ModuleAmoCrm = {\n\t$formObj: \t\t\t\t$('#'+idForm),\n\t$checkBoxes: \t\t\t$('#'+idForm+' .ui.checkbox'),\n\t$dropDowns: \t\t\t$('#'+idForm+' .ui.dropdown'),\n\tsaveTableAJAXUrl: \t\t`${window.location.origin}${globalRootUrl}${idUrl}/saveTableData`,\n\tdeleteRecordAJAXUrl: \t`${window.location.origin}${globalRootUrl}${idUrl}/delete`,\n\t$disabilityFields: \t\t$('div.disability'),\n\t$statusToggle: \t\t\t$('#module-status-toggle'),\n\t$moduleStatus: \t\t\t$('#status'),\n\tauthWindow: \t\t\tundefined,\n\n\t/**\n\t/**\n\t * Field validation rules\n\t * https://semantic-ui.com/behaviors/form.html\n\t */\n\tvalidateRules: {\n\t\ttextField: {\n\t\t\tidentifier: 'text_field',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.mod_tplValidateValueIsEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tareaField: {\n\t\t\tidentifier: 'text_area_field',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.mod_tplValidateValueIsEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tpasswordField: {\n\t\t\tidentifier: 'password_field',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.mod_tplValidateValueIsEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t},\n\tgeneratePassword() {\n\t\tlet length = 50,\n\t\t\tcharset = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\",\n\t\t\tretVal = \"\";\n\t\tfor (let i = 0, n = charset.length; i < length; ++i) {\n\t\t\tretVal += charset.charAt(Math.floor(Math.random() * n));\n\t\t}\n\t\treturn retVal;\n\t},\n\t/**\n\t * On page load we init some Semantic UI library\n\t */\n\tinitialize() {\n\t\t// инициализируем чекбоксы и выподающие менюшки\n\t\twindow[className].$checkBoxes.checkbox(\n\t\t\t{\n\t\t\t\tonChange: window[className].onChangeSettings\n\t\t\t}\n\t\t);\n\t\twindow[className].onChangeSettings()\n\t\twindow[className].$dropDowns.dropdown();\n\t\twindow[className].checkStatusToggle();\n\t\twindow.addEventListener('ModuleStatusChanged', window[className].checkStatusToggle);\n\t\twindow[className].initializeForm();\n\t\t$('.menu .item').tab();\n\n\t\twindow[className].checkStatus();\n\t\tsetInterval(window[className].checkStatus, 5000);\n\n\t\t$(window).bind('message',  window[className].updateAuthInfo);\n\t\t$(\"#createPassword\").on('click', function (e) {\n\t\t\t$(\"#tokenForAmo\").val(window[className].generatePassword());\n\t\t\t$('#submitbutton').removeClass('disabled');\n\t\t});\n\t\t$(\"#login-button\").on('click', function (e) {\n\t\t\tlet client_id \t = $('#clientId').val();\n\t\t\tif($('#isPrivateWidget').parent().checkbox('is checked')){\n\t\t\t\tclient_id = $('#privateClientId').val();\n\t\t\t}\n\t\t\tlet state \t\t = encodeURIComponent(client_id);\n\t\t\tlet redirect_uri = encodeURIComponent($('#redirectUri').val());\n\t\t\tlet url = `https://www.amocrm.ru/oauth?client_id=${client_id}&state=${state}&redirect_uri=${redirect_uri}&mode=post_message&scope=&approval_prompt=auto`;\n\t\t\twindow[className].popup = window.open(url, 'Auth', 'scrollbars, status, resizable, width=750, height=580');\n\t\t});\n\n\t\t$('body').on('click', 'a.delete', (e) => {\n\t\t\te.preventDefault();\n\t\t\tconst id = $(e.target).closest('tr').attr('id');\n\t\t\tModuleAmoCrm.deleteRule(id);\n\t\t});\n\n\t\t$('#entitySettingsTable').dataTable( {\n\t\t\tlengthChange: false,\n\t\t\tprocessing: true,\n\t\t\tpaging: false,\n\t\t\tdeferRender: true,\n\t\t\tautoWidth: false,\n\t\t\tcolumns: [\n\t\t\t\t{orderable: true, searchable: true},\n\t\t\t\t{orderable: true, searchable: true},\n\t\t\t\t{orderable: false, searchable: false},\n\t\t\t\t{orderable: false, searchable: false},\n\t\t\t\t{orderable: false, searchable: false},\n\t\t\t\t{orderable: false, searchable: false},\n\t\t\t\t{orderable: false, searchable: false},\n\t\t\t],\n\t\t\tlanguage: SemanticLocalization.dataTableLocalisation,\n\t\t\torder: [1, 'asc'],\n\t\t});\n\t},\n\tonChangeSettings() {\n\t\tif($('#isPrivateWidget').parent().checkbox('is checked')) {\n\t\t\t$('#private-fields').show();\n\t\t}else{\n\t\t\t$('#private-fields').hide();\n\t\t}\n\t},\n\t/**\n\t * Deletes an extension with the given ID.\n\t * @param {string} id - The ID of the rule to delete.\n\t */\n\tdeleteRule(id) {\n\t\t$('.message.ajax').remove();\n\t\t$.api({\n\t\t\turl: `${globalRootUrl}module-amo-crm/delete/${id}`,\n\t\t\ton: 'now',\n\t\t\tsuccessTest(response) {\n\t\t\t\t// test whether a JSON response is valid\n\t\t\t\treturn response !== undefined\n\t\t\t\t\t&& Object.keys(response).length > 0;\n\t\t\t},\n\t\t\tonSuccess(response) {\n\t\t\t\tif (response.success === true) {\n\t\t\t\t\t$('#entitySettingsTable').find(`tr[id=${id}]`).remove();\n\t\t\t\t} else {\n\t\t\t\t\tUserMessage.showError(response.message.error, globalTranslate.ex_ImpossibleToDeleteExtension);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t},\n\tcheckStatus(){\n\t\t$.get( `${window.location.origin}${globalRootUrl}${idUrl}/check`, function( result ) {\n\t\t\tlet elStatusAuth = $('#login-button');\n\t\t\telStatusAuth.removeClass('red green');\n\t\t\tif(result.success === true){\n\t\t\t\telStatusAuth.addClass('green')\n\t\t\t\telStatusAuth.text(globalTranslate.module_amo_crm_connect_ok);\n\t\t\t}else{\n\t\t\t\telStatusAuth.addClass('red')\n\t\t\t\telStatusAuth.text(globalTranslate.module_amo_crm_connect_fail);\n\t\t\t}\n\t\t\tif(result.data.lastContactsSyncTime === 0){\n\t\t\t\t$('#WaitSyncMsg').show();\n\t\t\t}else{\n\t\t\t\t$('#WaitSyncMsg').hide();\n\t\t\t}\n\t\t});\n\t},\n\n\tupdateAuthInfo(e) {\n\t\tlet params = {\n\t\t\t'code': e.originalEvent.data.code,\n\t\t\t'referer': $('#baseDomain').val(),\n\t\t\t'save-only': true\n\t\t};\n\t\t$(\"#warning-message\").hide();\n\t\tlet elStatusAuth = $('#login-button');\n\t\telStatusAuth.removeClass('red green');\n\t\telStatusAuth.text(globalTranslate.module_amo_crm_connect_refresh);\n\n\t\t$.post(`${window.location.origin}/pbxcore/api/modules/${className}/listener`, params, function( data ) {\n\t\t\tif(data.result === false){\n\t\t\t\tlet errorText = data.messages['error-data'].hint || '' + \" (\"+ data.messages['error-data'].detail || '' + \").\";\n\t\t\t\t$(\"#warning-message div.header\").text(globalTranslate.mod_amo_Error)\n\t\t\t\t$(\"#warning-message div.body\").text(errorText)\n\t\t\t\t$(\"#warning-message\").show();\n\t\t\t}\n\t\t});\n\t\twindow[className].popup.close();\n\t},\n\n\t/**\n\t * Подготавливает список выбора\n\t * @param selected\n\t * @returns {[]}\n\t */\n\tmakeDropdownList(selectType, selected) {\n\t\tconst values = [\n\t\t\t{\n\t\t\t\tname: ' --- ',\n\t\t\t\tvalue: '',\n\t\t\t\tselected: ('' === selected),\n\t\t\t}\n\t\t];\n\t\t$('#'+selectType+' option').each((index, obj) => {\n\t\t\tvalues.push({\n\t\t\t\tname: obj.text,\n\t\t\t\tvalue: obj.value,\n\t\t\t\tselected: (selected === obj.value),\n\t\t\t});\n\t\t});\n\t\treturn values;\n\t},\n\t/**\n\t * Обработка изменения группы в списке\n\t */\n\tchangeGroupInList(value, text, choice) {\n\t\tlet tdInput = $(choice).closest('td').find('input');\n\t\ttdInput.attr('data-value', \tvalue);\n\t\ttdInput.attr('value', \t\tvalue);\n\t\tlet currentRowId = $(choice).closest('tr').attr('id');\n\t\tlet tableName    = $(choice).closest('table').attr('id').replace('-table', '');\n\t\tif (currentRowId !== undefined && tableName !== undefined) {\n\t\t\twindow[className].sendChangesToServer(tableName, currentRowId);\n\t\t}\n\t},\n\n\t/**\n\t * Add new Table.\n\t */\n\tinitTable(tableName, options) {\n\t\tlet columns = [];\n\t\tlet columnsArray4Sort = []\n\t\tfor (let colName in options['cols']) {\n\t\t\tcolumns.push( {data: colName});\n\t\t\tcolumnsArray4Sort.push(colName);\n\t\t}\n\t\t$('#' + tableName).DataTable( {\n\t\t\tajax: {\n\t\t\t\turl: idUrl + options.ajaxUrl + '?table=' +tableName.replace('-table', ''),\n\t\t\t\tdataSrc: 'data'\n\t\t\t},\n\t\t\tcolumns: columns,\n\t\t\tpaging: false,\n\t\t\tsDom: 'rtip',\n\t\t\tdeferRender: true,\n\t\t\tpageLength: 17,\n\t\t\tinfoCallback( settings, start, end, max, total, pre ) {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tlanguage: SemanticLocalization.dataTableLocalisation,\n\t\t\tordering: false,\n\t\t\t/**\n\t\t\t * Builder row presentation\n\t\t\t * @param row\n\t\t\t * @param data\n\t\t\t */\n\t\t\tcreatedRow(row, data) {\n\t\t\t\tlet cols    = $('td', row);\n\t\t\t\tlet headers = $('#'+ tableName + ' thead tr th');\n\t\t\t\tfor (let key in data) {\n\t\t\t\t\tlet index = columnsArray4Sort.indexOf(key);\n\t\t\t\t\tif(key === 'rowIcon'){\n\t\t\t\t\t\tcols.eq(index).html('<i class=\"ui ' + data[key] + ' circle icon\"></i>');\n\t\t\t\t\t}else if(key === 'delButton'){\n\t\t\t\t\t\tlet templateDeleteButton = '<div class=\"ui small basic icon buttons action-buttons\">' +\n\t\t\t\t\t\t\t'<a href=\"' + window[className].deleteRecordAJAXUrl + '/' +\n\t\t\t\t\t\t\tdata.id + '\" data-value = \"' + data.DT_RowId + '\"' +\n\t\t\t\t\t\t\t' class=\"ui button delete two-steps-delete popuped\" data-content=\"' + globalTranslate.bt_ToolTipDelete + '\">' +\n\t\t\t\t\t\t\t'<i class=\"icon trash red\"></i></a></div>';\n\t\t\t\t\t\tcols.eq(index).html(templateDeleteButton);\n\t\t\t\t\t}else if(key === 'priority'){\n\t\t\t\t\t\tcols.eq(index).addClass('dragHandle')\n\t\t\t\t\t\tcols.eq(index).html('<i class=\"ui sort circle icon\"></i>');\n\t\t\t\t\t\t// Приоритет устанавливаем для строки.\n\t\t\t\t\t\t$(row).attr('m-priority', data[key]);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tlet template = '<div class=\"ui transparent fluid input inline-edit\">' +\n\t\t\t\t\t\t\t'<input colName=\"'+key+'\" class=\"'+inputClassName+'\" type=\"text\" data-value=\"'+data[key] + '\" value=\"' + data[key] + '\"></div>';\n\t\t\t\t\t\t$('td', row).eq(index).html(template);\n\t\t\t\t\t}\n\t\t\t\t\tif(options['cols'][key] === undefined){\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tlet additionalClass = options['cols'][key]['class'];\n\t\t\t\t\tif(additionalClass !== undefined && additionalClass !== ''){\n\t\t\t\t\t\theaders.eq(index).addClass(additionalClass);\n\t\t\t\t\t}\n\t\t\t\t\tlet header = options['cols'][key]['header'];\n\t\t\t\t\tif(header !== undefined && header !== ''){\n\t\t\t\t\t\theaders.eq(index).html(header);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet selectMetaData = options['cols'][key]['select'];\n\t\t\t\t\tif(selectMetaData !== undefined){\n\t\t\t\t\t\tlet newTemplate = $('#template-select').html().replace('PARAM', data[key]);\n\t\t\t\t\t\tlet template = '<input class=\"'+inputClassName+'\" colName=\"'+key+'\" selectType=\"'+selectMetaData+'\" style=\"display: none;\" type=\"text\" data-value=\"'+data[key] + '\" value=\"' + data[key] + '\"></div>';\n\t\t\t\t\t\tcols.eq(index).html(newTemplate + template);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t/**\n\t\t\t * Draw event - fired once the table has completed a draw.\n\t\t\t */\n\t\t\tdrawCallback(settings) {\n\t\t\t\twindow[className].drowSelectGroup(settings.sTableId);\n\t\t\t},\n\t\t} );\n\n\t\tlet body = $('body');\n\t\t// Клик по полю. Вход для редактирования значения.\n\t\tbody.on('focusin', '.'+inputClassName, function (e) {\n\t\t\tif($(e.target).parents('table').attr('id') === 'ModuleAmoPipeLines-table' && $(e.target).attr('colname') === 'name'){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$(e.target).transition('glow');\n\t\t\t$(e.target).closest('div').removeClass('transparent').addClass('changed-field');\n\t\t\t$(e.target).attr('readonly', false);\n\t\t})\n\t\t// Отправка формы на сервер по Enter или Tab\n\t\t$(document).on('keydown', function (e) {\n\t\t\tlet keyCode = e.keyCode || e.which;\n\t\t\tif (keyCode === 13 || keyCode === 9 && $(':focus').hasClass('mikopbx-module-input')) {\n\t\t\t\twindow[className].endEditInput();\n\t\t\t}\n\t\t});\n\n\t\tbody.on('click', 'a.delete', function (e) {\n\t\t\te.preventDefault();\n\t\t\tlet currentRowId = $(e.target).closest('tr').attr('id');\n\t\t\tlet tableName    = $(e.target).closest('table').attr('id').replace('-table', '');\n\t\t\twindow[className].deleteRow(tableName, currentRowId);\n\t\t}); // Добавление новой строки\n\n\t\t// Отправка формы на сервер по уходу с поля ввода\n\t\tbody.on('focusout', '.'+inputClassName, window[className].endEditInput);\n\n\t\t// Кнопка \"Добавить новую запись\"\n\t\t$('[id-table = \"'+tableName+'\"]').on('click', window[className].addNewRow);\n\t},\n\n\t/**\n\t * Перемещение строки, изменение приоритета.\n\t */\n\tcbOnDrop(table, row) {\n\t\tlet priorityWasChanged = false;\n\t\tconst priorityData = {};\n\t\t$(table).find('tr').each((index, obj) => {\n\t\t\tconst ruleId = $(obj).attr('id');\n\t\t\tconst oldPriority = parseInt($(obj).attr('m-priority'), 10);\n\t\t\tconst newPriority = obj.rowIndex;\n\t\t\tif (!isNaN( ruleId ) && oldPriority !== newPriority) {\n\t\t\t\tpriorityWasChanged = true;\n\t\t\t\tpriorityData[ruleId] = newPriority;\n\t\t\t}\n\t\t});\n\t\tif (priorityWasChanged) {\n\t\t\t$.api({\n\t\t\t\ton: 'now',\n\t\t\t\turl:`${window.location.origin}${globalRootUrl}${idUrl}/changePriority?table=`+$(table).attr('id').replace('-table', ''),\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdata: priorityData,\n\t\t\t});\n\t\t}\n\t},\n\n\t/**\n\t * Окончание редактирования поля ввода.\n\t * Не относится к select.\n\t * @param e\n\t */\n\tendEditInput(e){\n\t\tlet $el = $('.changed-field').closest('tr');\n\t\t$el.each(function (index, obj) {\n\t\t\tlet currentRowId = $(obj).attr('id');\n\t\t\tlet tableName    = $(obj).closest('table').attr('id').replace('-table', '');\n\t\t\tif (currentRowId !== undefined && tableName !== undefined) {\n\t\t\t\twindow[className].sendChangesToServer(tableName, currentRowId);\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Добавление новой строки в таблицу.\n\t * @param e\n\t */\n\taddNewRow(e){\n\t\tlet idTable = $(e.target).attr('id-table');\n\t\tlet table   = $('#'+idTable);\n\t\te.preventDefault();\n\t\ttable.find('.dataTables_empty').remove();\n\t\t// Отправим на запись все что не записано еще\n\t\tlet $el = table.find('.changed-field').closest('tr');\n\t\t$el.each(function (index, obj) {\n\t\t\tlet currentRowId = $(obj).attr('id');\n\t\t\tif (currentRowId !== undefined) {\n\t\t\t\twindow[className].sendChangesToServer(currentRowId);\n\t\t\t}\n\t\t});\n\t\tlet id = \"new\"+Math.floor(Math.random() * Math.floor(500));\n\t\tlet rowTemplate = '<tr id=\"'+id+'\" role=\"row\" class=\"even\">'+table.find('tr#TEMPLATE').html().replace('TEMPLATE', id)+'</tr>';\n\t\ttable.find('tbody > tr:first').before(rowTemplate);\n\t\twindow[className].drowSelectGroup(idTable);\n\t},\n\t/**\n\t * Обновление select элементов.\n\t * @param tableId\n\t */\n\tdrowSelectGroup(tableId) {\n\t\t$('#' + tableId).find('tr#TEMPLATE').hide();\n\t\tlet selestGroup = $('.select-group');\n\t\tselestGroup.each((index, obj) => {\n\t\t\tlet selectType = $(obj).closest('td').find('input').attr('selectType');\n\t\t\t$(obj).dropdown({\n\t\t\t\tvalues: window[className].makeDropdownList(selectType, $(obj).attr('data-value')),\n\t\t\t});\n\t\t});\n\t\tselestGroup.dropdown({\n\t\t\tonChange: window[className].changeGroupInList,\n\t\t});\n\n\t\t$('#' + tableId).tableDnD({\n\t\t\tonDrop: window[className].cbOnDrop,\n\t\t\tonDragClass: 'hoveringRow',\n\t\t\tdragHandle: '.dragHandle',\n\t\t});\n\t},\n\t/**\n\t * Удаление строки\n\t * @param tableName\n\t * @param id - record id\n\t */\n\tdeleteRow(tableName, id) {\n\t\tlet table = $('#'+ tableName+'-table');\n\t\tif (id.substr(0,3) === 'new') {\n\t\t\ttable.find('tr#'+id).remove();\n\t\t\treturn;\n\t\t}\n\t\t$.api({\n\t\t\turl: window[className].deleteRecordAJAXUrl+'?id='+id+'&table='+tableName,\n\t\t\ton: 'now',\n\t\t\tonSuccess(response) {\n\t\t\t\tif (response.success) {\n\t\t\t\t\ttable.find('tr#'+id).remove();\n\t\t\t\t\tif (table.find('tbody > tr').length === 0) {\n\t\t\t\t\t\ttable.find('tbody').append('<tr class=\"odd\"></tr>');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Отправка данных на сервер при измении\n\t */\n\tsendChangesToServer(tableName, recordId) {\n\t\tlet data = { 'pbx-table-id': tableName, 'pbx-row-id':  recordId};\n\t\tlet notEmpty = false;\n\t\t$(\"tr#\"+recordId + ' .' + inputClassName).each(function (index, obj) {\n\t\t\tlet colName = $(obj).attr('colName');\n\t\t\tif(colName !== undefined){\n\t\t\t\tdata[$(obj).attr('colName')] = $(obj).val();\n\t\t\t\tif($(obj).val() !== ''){\n\t\t\t\t\tnotEmpty = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif(notEmpty === false){\n\t\t\treturn;\n\t\t}\n\t\t$(\"tr#\"+recordId+\" .user.circle\").removeClass('user circle').addClass('spinner loading');\n\t\t$.api({\n\t\t\turl: window[className].saveTableAJAXUrl,\n\t\t\ton: 'now',\n\t\t\tmethod: 'POST',\n\t\t\tdata: data,\n\t\t\tsuccessTest(response) {\n\t\t\t\treturn response !== undefined && Object.keys(response).length > 0 && response.success === true;\n\t\t\t},\n\t\t\tonSuccess(response) {\n\t\t\t\tif (response.data !== undefined) {\n\t\t\t\t\tlet rowId = response.data['pbx-row-id'];\n\t\t\t\t\tlet table = $('#'+response.data['pbx-table-id']+'-table');\n\t\t\t\t\ttable.find(\"tr#\" + rowId + \" input\").attr('readonly', true);\n\t\t\t\t\ttable.find(\"tr#\" + rowId + \" div\").removeClass('changed-field loading').addClass('transparent');\n\t\t\t\t\ttable.find(\"tr#\" + rowId + \" .spinner.loading\").addClass('user circle').removeClass('spinner loading');\n\n\t\t\t\t\tif (rowId !== response.data['newId']){\n\t\t\t\t\t\t$(`tr#${rowId}`).attr('id', response.data['newId']);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonFailure(response) {\n\t\t\t\tif (response.message !== undefined) {\n\t\t\t\t\tUserMessage.showMultiString(response.message);\n\t\t\t\t}\n\t\t\t\t$(\"tr#\" + recordId + \" .spinner.loading\").addClass('user circle').removeClass('spinner loading');\n\t\t\t},\n\t\t\tonError(errorMessage, element, xhr) {\n\t\t\t\tif (xhr.status === 403) {\n\t\t\t\t\twindow.location = globalRootUrl + \"session/index\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Change some form elements classes depends of module status\n\t */\n\tcheckStatusToggle() {\n\t\tif (window[className].$statusToggle.checkbox('is checked')) {\n\t\t\twindow[className].$disabilityFields.removeClass('disabled');\n\t\t\twindow[className].$moduleStatus.show();\n\t\t} else {\n\t\t\twindow[className].$disabilityFields.addClass('disabled');\n\t\t\twindow[className].$moduleStatus.hide();\n\t\t}\n\t},\n\t/**\n\t * Send command to restart module workers after data changes,\n\t * Also we can do it on TemplateConf->modelsEventChangeData method\n\t */\n\tapplyConfigurationChanges() {\n\t\twindow[className].changeStatus('Updating');\n\t\t$.api({\n\t\t\turl: `${window.location.origin}/pbxcore/api/modules/`+className+`/reload`,\n\t\t\ton: 'now',\n\t\t\tsuccessTest(response) {\n\t\t\t\t// test whether a JSON response is valid\n\t\t\t\treturn Object.keys(response).length > 0 && response.result === true;\n\t\t\t},\n\t\t\tonSuccess() {\n\t\t\t\twindow[className].changeStatus('Connected');\n\t\t\t},\n\t\t\tonFailure() {\n\t\t\t\twindow[className].changeStatus('Disconnected');\n\t\t\t},\n\t\t});\n\t},\n\t/**\n\t * We can modify some data before form send\n\t * @param settings\n\t * @returns {*}\n\t */\n\tcbBeforeSendForm(settings) {\n\t\tconst result = settings;\n\t\tresult.data = window[className].$formObj.form('get values');\n\t\treturn result;\n\t},\n\t/**\n\t * Some actions after forms send\n\t */\n\tcbAfterSendForm() {\n\t\twindow[className].applyConfigurationChanges();\n\t},\n\t/**\n\t * Initialize form parameters\n\t */\n\tinitializeForm() {\n\t\tForm.$formObj = window[className].$formObj;\n\t\tForm.url = `${window.location.origin}${globalRootUrl}${idUrl}/save`;\n\t\tForm.validateRules = window[className].validateRules;\n\t\tForm.cbBeforeSendForm = window[className].cbBeforeSendForm;\n\t\tForm.cbAfterSendForm = window[className].cbAfterSendForm;\n\t\tForm.initialize();\n\t},\n\t/**\n\t * Update the module state on form label\n\t * @param status\n\t */\n\tchangeStatus(status) {\n\t\tswitch (status) {\n\t\t\tcase 'Connected':\n\t\t\t\twindow[className].$moduleStatus\n\t\t\t\t\t.removeClass('grey')\n\t\t\t\t\t.removeClass('red')\n\t\t\t\t\t.addClass('green');\n\t\t\t\twindow[className].$moduleStatus.html(globalTranslate.module_amo_crmConnected);\n\t\t\t\tbreak;\n\t\t\tcase 'Disconnected':\n\t\t\t\twindow[className].$moduleStatus\n\t\t\t\t\t.removeClass('green')\n\t\t\t\t\t.removeClass('red')\n\t\t\t\t\t.addClass('grey');\n\t\t\t\twindow[className].$moduleStatus.html(globalTranslate.module_amo_crmDisconnected);\n\t\t\t\tbreak;\n\t\t\tcase 'Updating':\n\t\t\t\twindow[className].$moduleStatus\n\t\t\t\t\t.removeClass('green')\n\t\t\t\t\t.removeClass('red')\n\t\t\t\t\t.addClass('grey');\n\t\t\t\twindow[className].$moduleStatus.html(`<i class=\"spinner loading icon\"></i>${globalTranslate.module_amo_crmUpdateStatus}`);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\twindow[className].$moduleStatus\n\t\t\t\t\t.removeClass('green')\n\t\t\t\t\t.removeClass('red')\n\t\t\t\t\t.addClass('grey');\n\t\t\t\twindow[className].$moduleStatus.html(globalTranslate.module_amo_crmDisconnected);\n\t\t\t\tbreak;\n\t\t}\n\t},\n};\n\n$(document).ready(() => {\n\twindow[className].initialize();\n});\n\n"],"file":"module-amo-crm-index.js"}